'use client';import { useEffect,useState } from 'react';type DayDigest={dayKey:string;mood:string;sentAt:string|null;items:any};type Req={id:string;songTitle:string;artist:string;link?:string|null;message?:string|null};export default function HistoryPage(){const [days,setDays]=useState(null as any);const [detail,setDetail]=useState(null as any);useEffect(()=>{fetch('/api/history').then(r=>r.json()).then(setDays)},[]);async function openDay(dayKey:string){const r=await fetch(`/api/history?day=${encodeURIComponent(dayKey)}`);const j=await r.json();setDetail(j);}return(<div className='container py-8'><h1 className='mb-4 text-2xl font-bold'>ประวัติการขอเพลงย้อนหลัง</h1><div className='grid gap-6 md:grid-cols-2'><section className='card'><h2 className='mb-3 text-lg font-semibold'>วันที่มีประกาศ</h2><div className='grid gap-2 max-h-[70vh] overflow-y-auto pr-2'>{(days?.days||[]).map((d:any)=>(<button key={d.dayKey} onClick={()=>openDay(d.dayKey)} className='flex items-center justify-between rounded-xl border px-4 py-3 text-left hover:bg-gray-50'><span>{d.dayKey}</span><span className='text-xs text-gray-500'>{d.mood}</span></button>))}{!days&&<p className='text-sm text-gray-500'>กำลังโหลด…</p>}</div></section><section className='card'><h2 className='mb-3 text-lg font-semibold'>รายละเอียด</h2>{!detail&&<p className='text-sm text-gray-500'>เลือกวันที่จากด้านซ้ายเพื่อดูรายการที่อนุมัติ</p>}{detail&&(<div className='grid gap-2'><p className='text-sm text-gray-600'>วันที่: <b>{detail.day}</b></p>{(Array.isArray(detail.items)? [...detail.items].sort((a:any,b:any)=> (a.createdAt?.seconds||0)-(b.createdAt?.seconds||0)) : []).map((x:Req)=>(<div key={x.id} className='rounded-xl border p-3'><div className='flex items-center justify-between gap-3'><div><p className='font-medium'>{x.songTitle} — {x.artist}</p>{x.message&&<p className='text-xs text-gray-500'>ฝากบอก: {x.message}</p>}</div>{x.link&&<a href={x.link} target='_blank' className='text-sm underline'>ฟัง</a>}</div></div>))}{detail.items?.length===0&&<p className='text-sm text-gray-500'>ยังไม่มีรายการอนุมัติในวันที่เลือก</p>}</div>)}</section></div></div>)}
